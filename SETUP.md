# Setup Guide for Collaborators

## Quick Setup (Recommended)

### macOS/Linux:
```bash
chmod +x install.sh
./install.sh
```

### Windows:
```cmd
install.bat
```

The installation script will automatically:
- ✅ Create Python virtual environment
- ✅ Install all dependencies
- ✅ Generate all required OpenVPN certificates
- ✅ Set up necessary directories

## Manual Setup (Alternative)

If you prefer manual setup or the script doesn't work:

### 1. Create Virtual Environment
```bash
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

### 2. Install Dependencies
```bash
pip install -r requirements.txt
```

### 3. Generate Certificates

The certificates are automatically generated by `install.sh`. If you need to generate them manually:

#### Using install.sh (macOS/Linux):
```bash
./install.sh
```

#### Using install.bat (Windows):
```cmd
install.bat
```

#### Manual Certificate Generation:

```bash
# Generate CA
openssl req -x509 -newkey rsa:2048 -keyout ca.key -out ca.crt -days 3650 -nodes \
    -subj "/C=US/ST=CA/L=SanFrancisco/O=ZTNA/OU=IT/CN=ZTNA-CA"

# Generate server certificate
openssl genrsa -out server.key 2048
openssl req -new -key server.key -out server.csr \
    -subj "/C=US/ST=CA/L=SanFrancisco/O=ZTNA/OU=Server/CN=server"
openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial \
    -out server.crt -days 3650
rm server.csr

# Generate client certificate
openssl genrsa -out client.key 2048
openssl req -new -key client.key -out client.csr \
    -subj "/C=US/ST=CA/L=SanFrancisco/O=ZTNA/OU=Client/CN=client"
openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key -CAcreateserial \
    -out client.crt -days 3650
rm client.csr

# Generate DH parameters
openssl dhparam -out dh2048.pem 2048
```

### 4. Create Directories
```bash
mkdir -p temp_ovpn
touch ipp.txt
touch openvpn-status.log
```

## Verify Installation

After installation, verify everything works:

```bash
source venv/bin/activate  # Windows: venv\Scripts\activate
python test_openvpn_setup.py
```

Expected output: `✅ All checks passed!`

## Start Services

Open 3 terminal windows:

**Terminal 1:**
```bash
source venv/bin/activate
python auth_server.py
```

**Terminal 2:**
```bash
source venv/bin/activate
python vpn_gateway.py
```

**Terminal 3:**
```bash
source venv/bin/activate
python policy_engine.py
```

## Test the System

```bash
source venv/bin/activate
python ztna_client.py login alice@company.com:password123
python ztna_client.py request-vpn
python ztna_client.py connect-vpn
python ztna_client.py vpn-status
```

## Troubleshooting

### Certificates Missing
Run the install script again:
```bash
./install.sh  # macOS/Linux
install.bat   # Windows
```

### OpenVPN Not Installed
The system works in mock mode without OpenVPN. To install:
- **macOS**: `brew install openvpn`
- **Ubuntu**: `sudo apt-get install openvpn`
- **Windows**: Download from https://openvpn.net/

### Port Already in Use
```bash
# Find process using port
lsof -i :5000  # macOS/Linux
netstat -ano | findstr :5000  # Windows

# Kill process
kill -9 <PID>  # macOS/Linux
taskkill /PID <PID> /F  # Windows
```

## Files Generated by install.sh

The installation script creates:
- `venv/` - Virtual environment (excluded from git)
- `ca.crt`, `ca.key` - Certificate Authority (excluded from git)
- `server.crt`, `server.key` - Server certificate (excluded from git)
- `client.crt`, `client.key` - Client certificate (excluded from git)
- `dh2048.pem` - Diffie-Hellman parameters (excluded from git)
- `temp_ovpn/` - Temporary VPN configs directory
- `ipp.txt` - IP pool file
- `openvpn-status.log` - Status log

**Note**: Certificate files are excluded from git for security. Each collaborator generates their own.

